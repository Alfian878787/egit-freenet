<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content="HTML Tidy for Linux/x86 (vers 7 December 2008), see www.w3.org">
  <style type="text/css">
pre{margin:1em;font-size:90%;background-color:#f8f8ff;border:1px solid #dedede;padding:.5em;line-height:1.5em;color:#444;overflow:auto;}
  pre code{padding:0;font-size:100%;background-color:#f8f8ff;border:none;}
  code{font-size:90%;background-color:#f8f8ff;color:#444;padding:0 .2em;border:1px solid #dedede;}
  </style>

  <title>Git Over Freenet</title>
</head>

<body>
  <h1><img src="activelink.png" align="left">Git Over Freenet</h1>

  <h1>Git Over Freenet</h1>The code need some more cleanups, so it is not ready for apply (yet). It will be rebased / reorganized from time to time, until it is merged upstream.

  <h2>0. Download</h2>The main repository is hosted at GitHub (http://wiki.github.com/j16sdiz/egit-freenet) and is mirrored at <code>fcp://USK@VoFcfs8Y3VQfwD66ZgXAb4HBiS~WJe8w9mOy2hS9Mh8,OS6~bhX8LHxMLw-sruBkWDeACo-fg4yBZqueMPVj1Uc,AQACAAE/egit-freenet.git</code>.

  <h2>1. Usage Example</h2>

  <h3>1.1 Push (using jgit):</h3>
  <pre> $ echo "publicKey=[my public key]"  &gt; .git/config-name
$ echo "privateKey=[my private key]"  &gt;&gt; .git/config-name
$ git remote add fcp fcp://config-name/test.git
$ ./jgit push fcp master
</pre>
  <h3>1.2 Push (using jSite, for "seeding" only):</h3>

  <ol>
    <li>Create a bare repository for your code</li>

    <li><code>git update-server-info</code></li>

    <li>Use jSite to upload your repositoty to <code>USK@[.....]/test.git/0/</code></li>
  </ol>

  <h3>1.3 Pull (cloning):</h3>
  <pre> $ ./jgit clone fcp://USK@[public key]/test.git
</pre>OR
  <pre> $ echo "publicKey=[my public key]"  &gt; ~/config-name
$ ./jgit clone fcp://config-name/test.git
</pre>
  <h3>1.4 Dogfooding</h3>For a sample repository (egit-freenet), try:
  <pre> $ jgit clone fcp://USK@VoFcfs8Y3VQfwD66ZgXAb4HBiS~WJe8w9mOy2hS9Mh8,OS6~bhX8LHxMLw-sruBkWDeACo-fg4yBZqueMPVj1Uc,AQACAAE/<code>egit-freenet.git</code> 
</pre>
  <h2>2. Path Mangling</h2>

  <p>To workaround the metadata update problem, this client translate the path separator to "<code>-</code>" (let's call it "loose" URI). To be specific:</p>

  <table>
    <tbody>
      <tr>
        <th>Git DB Path</th>

        <th>Freenet URI (loose)</th>

        <th>Freenet URI (archive)</th>
      </tr>

      <tr>
        <td><code>aa/bbbbbbbb</code></td>

        <td><code>USK@..../test.git-objects-aa-bbbbbbb/0</code></td>

        <td><code>USK@..../test.git/1/objects/aa/bbbbbbb</code></td>
      </tr>

      <tr>
        <td><code>../refs/heads/xxx</code></td>

        <td><code>USK@..../test.git-objects-ref-heads-xxx/0</code></td>

        <td><code>USK@..../test.git/1/objects/ref/heads/xxx</code></td>
      </tr>
    </tbody>
  </table>

  <h3>2.1 On push:</h3>

  <p>Always use loose URI.</p>

  <h3>2.2 On pull:</h3>For <code>Refs</code> (<code>info/refs</code>):

  <ul>
    <li>First check loose URI <code>USK@..../test.git-info-refs/1</code>

      <ul>
        <li>If it fails, use the archive URI <code>USK@..../test.git/1/info/refs</code>.</li>
      </ul>
    </li>
  </ul>For objects / packs:

  <ul>
    <li>Always check loose URI first.</li>

    <li>Add archive URI as alternative object database.</li>

    <li>Standard alternative file <code>../info/alternatives</code> is NOT supported.</li>
  </ul>

  <p>Using this approach we can insert an repository using jSite and update it incrementally.</p>

  <h2>3. TODO</h2>

  <ul>
    <li>No progress meter for pull.</li>

    <li>We have to wait for first <code>SimpleProgress</code> before displaying the progress, could we do better?</li>

    <li>Once we have update a repository using <code>jgit push</code>, we should never use jSite to update again. (We always pull the "loose" files first)</li>

    <li>There is a known bug.</li>

    <li>jGit pack everything into one pack file. But freenet does not handle large files well. How can we, lets say, generate a pack file for every 200 objects? every 2MiB?</li>
  </ul>

  <h2>Frequently Asked Questions</h2>

  <ol>
    <li>FProxy works, why egit-freenet?

      <ul>
        <li>Try to push with FProxy. (Hints: It don't work)</li>
      </ul>
    </li>

    <li>Why not just use the archive URI (<code>USK@..../test.git/1/objects/aa/bbbbbbb</code>)?

      <ul>
        <li>In freenet, all files under <code>USK@..../test.git/1/*</code> are packed in a zip file (that's why I call it archive URI) and must be updated at once. If we use this, we have to upload all pack files again on every push, and this is not what I want. Of course I can do some magic ... but that's beyond what a "proof of concept" should do.</li>
      </ul>
    </li>

    <li>You don't upload all files ? ! ? ! What if they fall out of the network ? ! ? ! ? !

      <ul>
        <li>We use the archive URI as alternative object database. Just upload the bare repository in archive URI and case closed. This give a good balance of availability and pushing speed.</li>
      </ul>
    </li>

    <li>Why not just insert every pack as <code>CHK@</code>?

      <ul>
        <li>There are zillions of way to generate the pack and compress the files. They are not guaranteed to be identical -- so, no, there is no way to get the same <code>CHK@</code></li>
      </ul>
    </li>

    <li>So why not just insert the raw (decompressed) object?

      <ul>
        <li>You know the raw object are not delta-ified and very large, right? or do you?</li>
      </ul>
    </li>

    <li>Why not update the archive each time you push?

      <ul>
        <li>Here are two problem: (1) How to update the archive and (2) What if we can't?

          <p>First question can be solved by using SiteToolPlugin (some something simliar), and I am just too lazy to do this</p>

          <p>The another question is based on the fact that the archive grown by one pack file each time you push. In freenet, there is a limit of number of file in a directory -- what should we do when it excess the limit? Repack everything? geee! That's not something can be done using the jgit transport api.... and I tried not to be so invensive....</p>
        </li>
      </ul>
    </li>
  </ol>

  <address>
    sdiz@sdiz.freemail
  </address>
</body>
</html>
